<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/mmlswa.github.io/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/mmlswa.github.io/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/mmlswa.github.io/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/mmlswa.github.io/images/tubiao.jpg?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/mmlswa.github.io/images/tubiao.jpg?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/mmlswa.github.io/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/mmlswa.github.io/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="1、（8分）import java.sql.;/**  @Description 连接数据库工具类  public class DBConn {private String DRIVER = “com.mysql.jdbc.Driver”;private String USERNAME = “root”;Private String PASSWORD = “root”;private String">
<meta property="og:type" content="article">
<meta property="og:title" content="jsp">
<meta property="og:url" content="http://yoursite.com/2020/05/27/Untitled/index.html">
<meta property="og:site_name" content="wzh_forever">
<meta property="og:description" content="1、（8分）import java.sql.;/**  @Description 连接数据库工具类  public class DBConn {private String DRIVER = “com.mysql.jdbc.Driver”;private String USERNAME = “root”;Private String PASSWORD = “root”;private String">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2020-05-27T05:22:51.177Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="jsp">
<meta name="twitter:description" content="1、（8分）import java.sql.;/**  @Description 连接数据库工具类  public class DBConn {private String DRIVER = “com.mysql.jdbc.Driver”;private String USERNAME = “root”;Private String PASSWORD = “root”;private String">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/mmlswa.github.io/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2020/05/27/Untitled/"/>





  <title>jsp | wzh_forever</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/mmlswa.github.io/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">wzh_forever</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">suantangmian</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/mmlswa.github.io/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/mmlswa.github.io/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/mmlswa.github.io/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/mmlswa.github.io/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/mmlswa.github.io/2020/05/27/Untitled/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ZhouHua">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/mmlswa.github.io/images/head.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="wzh_forever">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">jsp</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-05-27T13:22:22+08:00">
                2020-05-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i>
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>1、（8分）<br>import java.sql.<em>;<br>/** </em> @Description 连接数据库工具类 </p>
<p>public class DBConn {<br>private String DRIVER = “com.mysql.jdbc.Driver”;<br>private String USERNAME = “root”;<br>Private String PASSWORD = “root”;<br>private String URL = “jdbc:mysql://localhost:3306/“;<br>private Connection conn = null;<br>private PreparedStatement ps = null;<br>private ResultSet rs = null;<br> /*<em>     </em> 第一步：加载数据库驱动    </p>
<ul>
<li>第二步：建立数据库连接     <ul>
<li>@param dbName 数据库名     */<br>public DBConn(String dbName){<br>try {<br>Class.forName(DRIVER);<br>URL = URL + dbName;<br>conn = DriverManager.getConnection(URL,USERNAME,PASSWORD);<br>   } catch (ClassNotFoundException e) {<br>e.printStackTrace();<br>} catch (SQLException e) {<br>e.printStackTrace();<br>}<br>}<br>/**    </li>
</ul>
</li>
<li>第三步：编写sql语句     <ul>
<li>第四步：建立sql语句执行器preparedStatement     </li>
<li>@param sql sql语句     */<br>public void preparedStatement(String sql){<br>try {<br>ps = conn.prepareStatement(sql);<br>} catch (SQLException e) {<br>e.printStackTrace();<br>}<br>}<br>/**     </li>
<li>第五步：将占位符用参数替代     </li>
<li>@param index 占位符索引（第一个为1）     </li>
<li>@param value 参数值     */<br>public void setString(int index,String value){<br>try {<br>ps.setString(index,value);<br>} catch (SQLException e) {<br>e.printStackTrace();<br>}<br>}<br>public void setInt(int index,int value){<br>try {<br>ps.setInt(index,value);<br>} catch (SQLException e) {<br>e.printStackTrace();<br>}<br>}<br>/**     </li>
<li>第六步：执行sql语句，返回受影响行数    </li>
</ul>
</li>
<li>@return 执行sql语句受影响行数<br>*/<br>public int executeUpdate(){<br>try {<br>//System.out.println(ps);<br>return ps.executeUpdate();<br>} catch (SQLException e) {<br>e.printStackTrace();<br>}        return 0;<br>}<br>/**     <ul>
<li>第六步：执行sql语句，返回结果集     </li>
<li>@return ResultSet<br>*/<br>public ResultSet executeQuery(){<br>try {<br>return ps.executeQuery();<br>} catch (SQLException e) {<br>e.printStackTrace();<br>}<br>return null;<br>}<br>/**     </li>
<li>关闭连接以及其他<br>*/<br>public void close(){<br>try{<br>if(rs != null){<br>rs.close();<br>}<br>if(ps != null){<br>ps.close();<br>}<br>if(conn != null){<br>conn.close();<br>}<br>} catch (SQLException e) {<br>e.printStackTrace();<br>}<br>}}</li>
</ul>
</li>
</ul>
<p>2、（10分）<br>function checkreg(){<br>var msg = “对不起，输入错误/n”;<br>var regform = document.all.reg;<br>var username = regform.username;<br>var userage = regfrom.userage;<br>var password1 = regform.password1;<br>var password2 = regform.password2;<br>var reg = new RegExp(“^([1-9]|[1-9]\d|99)$”);<br>var usern = /^[a-zA-Z0-9_]{1,}$/;<br>//alert(username.value);<br>if (!username.value.match(usern)) {<br>msg += “用户名只能由字母数字下划线组成/n”;<br>alert(msg);<br>username.value = ‘’;<br>username.focus();<br>return false;<br>}<br>if(password1.value.length != 6 || password2.value.length) {<br>msg+=‘密码长度不能少于6位’;<br>return false;<br>}<br>if(password1.value != password2.value)<br>{<br>msg += ‘两次输入密码不一致’;<br>alert(msg);<br>password1.value = ‘’;<br>password2.value = ‘’;<br>password1.focus();<br>return false;<br>}<br>if(if(!reg.test(userage))){<br>mag += ‘年龄必须在1-99岁之间’;<br>return false;<br>}<br>return true;<br>} </p>
<p>3、（10分）<br>–创建数据库<br>USE test_db;<br>CREATE TABLE regUsers(<br>   id INT(11),<br>   userName VARCHAR(25),<br>   userPassword  VARCHAR(25),<br>   userSex CHAR(2),<br>   userAeg INT(4)<br>);</p>
<p>Dao.java文件<br>package Dao;</p>
<p>import java.sql.Connection;<br>import java.sql.Statement;</p>
<p>import DBUtil.DBUtil;</p>
<p>import Entity.User;</p>
<p>public class Dao {</p>
<pre><code>public boolean add(User user) {
    //将数据插入数据库的SQL语句
    String sql = &quot;insert into regUsers(userName,userPassword,userSex,userAeg) values(&apos;&quot;+ user.getUsername() + &quot;&apos;,&apos;&quot;+ user.getuserPassword() +&quot;&apos;,&apos;&quot;+user.userSex() +&quot;&apos;,&apos;&quot;+ user.userAeg()&quot;;
    // 创建数据库链接
    Connection conn = DBUtil.getConn();
    Statement state = null;
    boolean f = false;
    int a = 0;

    try {
        state = conn.createStatement();
        a=state.executeUpdate(sql);
    } catch (Exception e) {
        e.printStackTrace();
    } finally {
        // 关闭z 连接
        DBUtil.close(state, conn);
    }

    if (a &gt; 0) {
        f = true;
    }
    return f;
</code></pre><p>}<br>}</p>
<p>DBUtil.java文件<br>package DBUtil;</p>
<p>import java.sql.Connection;<br>import java.sql.DriverManager;<br>import java.sql.PreparedStatement;<br>import java.sql.ResultSet;<br>import java.sql.SQLException;<br>import java.sql.Statement;</p>
<p>/**</p>
<ul>
<li><p>@author Hu<br><em>
</em>/<br>public class DBUtil {</p>
<p> public static String db_url = “jdbc:mysql://localhost:3306/user?serverTimezone=UTC”;//登录数据库<br> public static String db_user = “root”;<br> public static String db_pass = “root”;</p>
<p> public static Connection getConn () {</p>
<pre><code>Connection conn = null;

try {
    Class.forName(&quot;com.mysql.cj.jdbc.Driver&quot;);//加载驱动
    conn = DriverManager.getConnection(db_url, db_user, db_pass);
} catch (Exception e) {
    e.printStackTrace();
}

return conn;
</code></pre><p> }<br>  /**</p>
<pre><code>* 关闭与数据库的连接
</code></pre><ul>
<li>@param state</li>
<li><p>@param conn<br>*/<br>public static void close (Statement state, Connection conn) {<br> if (state != null) {</p>
<pre><code>try {
    state.close();
} catch (SQLException e) {
    e.printStackTrace();
}
</code></pre><p> }</p>
<p> if (conn != null) {</p>
<pre><code>try {
    conn.close();
} catch (SQLException e) {
    e.printStackTrace();
}
</code></pre><p> }<br>}</p>
<p>public static void close (ResultSet rs, Statement state, Connection conn) {<br> if (rs != null) {</p>
<pre><code>try {
    rs.close();
} catch (SQLException e) {
    e.printStackTrace();
}
</code></pre><p> }</p>
<p> if (state != null) {</p>
<pre><code>try {
    state.close();
} catch (SQLException e) {
    e.printStackTrace();
}
</code></pre><p> }</p>
<p> if (conn != null) {</p>
<pre><code>try {
    conn.close();
} catch (SQLException e) {
    e.printStackTrace();
}
</code></pre><p> }<br>}<br>public static void main(String[] args) throws SQLException {<br> Connection conn = getConn();<br> PreparedStatement pstmt = null;<br> ResultSet rs = null;<br> String sql =”select * from users”;<br> pstmt = conn.prepareStatement(sql);<br> rs = pstmt.executeQuery();<br> if(rs.next()){</p>
<pre><code>System.out.println(&quot;空&quot;);
</code></pre><p> }else{</p>
<pre><code>System.out.println(&quot;不空&quot;);
</code></pre><p> }<br>}<br>}</p>
</li>
</ul>
</li>
</ul>
<p>User.java(用户属性类)文件<br>package Entity;</p>
<p>public class User {</p>
<pre><code>private String username;
private String userpassword;
</code></pre><p>private String usersex;<br>    private int  userage;</p>
<pre><code>public String getUsername() {
    return username;
}

public void setUsername(String username) {
    this.username = username;
}

public String getuserPassword() {
    return password;
}

public void setuserPassword(String password) {
    this.userPassword = password;
}

public String getuserSex() {
    return userSex;
}

public void setuserSex(String sex) {
    thisuserSex = sex;
}

public int getuserAge() {
    return userAge;
}

public void setuserAgeName(int age) {
    this.userAge= age;
</code></pre><p>}</p>
<pre><code>public User() {}
</code></pre><p>public User(String username,String userpassword,String sex,int age) {</p>
<pre><code>    this.userName=username;
    this.userPassword=password;
    thisuserSex=sex;
    this.userAge=age;
}
</code></pre><p>}</p>
<p>Servlet.java文件<br>package Servlet;</p>
<p>import java.io.IOException;</p>
<p>import javax.servlet.ServletException;<br>import javax.servlet.annotation.WebServlet;<br>import javax.servlet.http.HttpServlet;<br>import javax.servlet.http.HttpServletRequest;<br>import javax.servlet.http.HttpServletResponse;</p>
<p>import Dao.Dao;</p>
<p>import Entity.User;</p>
<p>@WebServlet(“/Servlet”)<br>public class Servlet extends HttpServlet {<br>    private static final long serialVersionUID = 1L;</p>
<pre><code>public Servlet() {
    super();

}
protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
    req.setCharacterEncoding(&quot;utf-8&quot;);
    String method = req.getParameter(&quot;method&quot;);
    if (&quot;add&quot;.equals(method)) {
        add(req, resp);
    } 
}


public void add(HttpServletRequest req, HttpServletResponse resp) throws IOException, ServletException{
    req.setCharacterEncoding(&quot;utf-8&quot;);
    String username = req.getParameter(&quot;username&quot;);
    String password = req.getParameter(&quot;password&quot;);
    String sex = req.getParameter(&quot;sex&quot;);
    int age = Integer.parseInt(req.getParameter(&quot;age&quot;));

    //调用用户属性类
    User user = new User(username,password,sex,age);
    //接受判断函数返回值
    Dao dao =new Dao();
    boolean f=dao.add(user);
    //提示信息
    if(f) {
        req.setAttribute(&quot;message&quot;, &quot;注册成功！&quot;);
        req.getRequestDispatcher(&quot;users.jsp&quot;).forward(req,resp);
    } 
    else {
        req.setAttribute(&quot;message&quot;, &quot;已有账号，重复登录！&quot;);
        req.getRequestDispatcher(&quot;users.jsp&quot;).forward(req,resp);
    }
}
</code></pre><p>}</p>
<p>users.jsp文件</p>
<p>&lt;%@ page language=”java” contentType=”text/html; charset=UTF-8”<br>    pageEncoding=”UTF-8”%&gt;<br>&lt;!DOCTYPE html&gt;</p>
<html><br><head><meta name="generator" content="Hexo 3.8.0"><br><meta charset="UTF-8"><br><title>注册用户</title><br></head><br><br>    <body><br>        <table border="0px" cellpadding="10px" cellspacing="0px" style="width: 50%;margin:auto;background:rgb(195,195,195)" bordercolor="red"><br>                    <form action="Servlet?method=add" method="post" onsubmit="return check()"><br>            <caption>当前位置：添加用户信息</caption><br>                <tr><br>                    <td>登录账号:</td><br>                    <td><input type="text" name="username" id="username"></td><br>                </tr><br>                <tr><br>                    <td>登录密码:</td><br>                    <td><input type="password" name="password" id="password"></td><br>                </tr><br>                <tr><br>                    <td>性别:</td><br>                    <td><br>                    <select name="sex"><br>                            <option value="男">男</option><br>                            <option value="女">女</option><br>                      </select><br>                    </td><br>                </tr><br>                <tr><br>                    <td>年龄:</td><br>                    <td><input type="text" name="age"></td><br>                </tr><br>            </form><br>        </table><br>    <script src="/mmlswa.github.io/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body><br></html>

<p>4、（12分）<br>配置：<br>&lt;?xml version=”1.0” encoding=”UTF-8”?&gt;</p>
<p><web-app xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://java.sun.com/xml/ns/javaee" xmlns:web="http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd" xsi:schemalocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd" version="2.5"><br>    <context-param><br>        <!-- 加载spring配置文件 --><br>        <param-name>contextConfigLocation</param-name><br>        <param-value><br>            /WEB-INF/spring/applicationContext.xml<br>        </param-value><br>    </context-param></web-app></p>
<pre><code>&lt;!-- spring mvc DispatcherServlet --&gt;
&lt;servlet&gt;
    &lt;servlet-name&gt;spring&lt;/servlet-name&gt;
    &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;
    &lt;init-param&gt;
        &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
        &lt;param-value&gt;/WEB-INF/spring/spring-mvc.xml&lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;!-- 表示容器在启动时就加载并初始化这个servlet --&gt;
    &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
&lt;/servlet&gt;
&lt;servlet-mapping&gt;
    &lt;servlet-name&gt;spring&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;

&lt;!-- URL权限过滤 --&gt;
&lt;filter&gt;
    &lt;filter-name&gt;authorityFilter&lt;/filter-name&gt;
    &lt;!-- 注册过滤器类 --&gt;
    &lt;filter-class&gt;com.qly.b2b.web.common.AuthorityFilter&lt;/filter-class&gt;
    &lt;init-param&gt;
        &lt;!-- 设置编码 --&gt;
        &lt;param-name&gt;encoding&lt;/param-name&gt;
        &lt;param-value&gt;UTF-8&lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;init-param&gt;
        &lt;!-- 设置不需要验证的url路径包括js css 图片等信息  根据自己需要增减 --&gt;
        &lt;param-name&gt;unCheckPaths&lt;/param-name&gt;
        &lt;param-value&gt;/images,/queryinfo,/js,/css,/login,/desklogin,/index/images&lt;/param-value&gt;
    &lt;/init-param&gt;
&lt;/filter&gt;
&lt;filter-mapping&gt;
    &lt;filter-name&gt;authorityFilter&lt;/filter-name&gt;
    &lt;!-- 对所有路径过滤 --&gt;
    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
&lt;/filter-mapping&gt;

&lt;welcome-file-list&gt;
    &lt;welcome-file&gt;/view/login/index.jsp&lt;/welcome-file&gt;
&lt;/welcome-file-list&gt;
</code></pre><p><br>过滤器代码：<br>/**</p>
<ul>
<li><p>用户权限校验过滤器，针对URL进行权限校验<br>*/<br>public class AuthorityFilter implements Filter {// 所有自定义的过滤器都需实现filter接口</p>
<p> // 不需要校验权限的URL  容器启动 过滤器初始化时会先加载web.xml文件中配置的不需要校验权限的URL<br> String[] noCheckPaths = null;<br> // 访问的工程名  同上，假如是访问localhost:8080/user   得到的是/user<br> String contextPath = null;</p>
<p> // 用redis缓存sessionId  每次请求时直接缓存数据库中查找，优化速度<br> private RedisTemplate redisTemplate;</p>
<p> // 销毁<br> public void destroy() {<br> }</p>
<p> // 过滤执行的逻辑代码<br> public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain chain)</p>
<pre><code>    throws IOException, ServletException {
HttpServletRequest request = (HttpServletRequest) servletRequest;
HttpServletResponse response = (HttpServletResponse) servletResponse;
String path = request.getServletPath();
// 获取当前浏览器访问网站生成的sessionId
String currentSessionId = request.getSession().getId();

ServletContext sc = request.getSession().getServletContext();
XmlWebApplicationContext cxt = (XmlWebApplicationContext) WebApplicationContextUtils.getWebApplicationContext(sc);
// 从容器中获取redisTemplate  bean
// if(cxt != null &amp;&amp; cxt.getBean(&quot;redisTemplate&quot;) != null)
redisTemplate = (RedisTemplate) cxt.getBean(&quot;redisTemplate&quot;);

// 从session取得登录用户信息
User user = (User) request.getSession().getAttribute(&quot;User&quot;);

if(user != null ){// 用户信息不为空
    // 从redis缓存数据库取出该用户的sessionId
    String dbSessionId = (String) redisTemplate.opsForValue().get(user.getUserId());
    if(currentSessionId.endsWith(dbSessionId)){// 作比较，相等则放行
        chain.doFilter(servletRequest, servletResponse);
    }else{
        if (this.isVerification(path)) {// sessionId不相等则判断请求url是否要验证  为true则跳转到登录页面
            String toPath = &quot;/login&quot;;
            response.setContentType(&quot;text/html; charset=utf-8&quot;); // 防止出现乱码
            response.getWriter().write(&quot;&lt;script&gt;alert(&apos;&quot;+&quot;该账号已在别的设备登录，如非本人操作，请及时修改密码，确保资金安全！&quot;+&quot;&apos;)&lt;/script&gt;&quot;);
            // 因为项目中用到iframe,故需要在顶层窗口跳转
            response.getWriter().write(&quot;&lt;script&gt;top.location.href=&apos;&quot; + contextPath + toPath + &quot;&apos;&lt;/script&gt;&quot;);
            return;
        } else {
            chain.doFilter(servletRequest, servletResponse);
        }
    }

} else {// 用户信息为空
    // 判断url是否验证
    if (this.isVerification(path)) {//  为true则跳转到登录页面
        String toPath = &quot;/login&quot;;
        // 顶层窗口即浏览器窗口框打开  应对frame嵌套
        response.getWriter().write(&quot;&lt;script&gt;top.location.href=&apos;&quot; + contextPath + toPath + &quot;&apos;&lt;/script&gt;&quot;);
        // response.getWriter().write(&quot;&lt;script&gt;window.parent.location.href=&apos;&quot; + contextPath + toPath + &quot;&apos;&lt;/script&gt;&quot;);// 在父窗口打开
        // response.sendRedirect(contextPath + toPath);  // 重定向
        //response.getWriter().write(&quot;&lt;script&gt;window.location.href=&apos;&quot; + contextPath + toPath + &quot;&apos;&lt;/script&gt;&quot;); // 在当前窗口打开
        return;
    } else {// 放行
        chain.doFilter(servletRequest, servletResponse);
    }
}
</code></pre><p> }</p>
</li>
</ul>
<pre><code>/**
 * 
 * isVerification(判断指定的url是否需要验证，默认是需要验证的) (这里描述这个方法适用条件 – 可选)
 * @param path
 * @return false代表不用验证 true 代表需要进行验证 Boolean 
 * @exception
 */
private Boolean isVerification(String path) {
    // 默认需要验证url
    boolean isVerification = true;

    if (&quot;/&quot;.equals(path)) { // 防止无限重定向
        return false;
    }
    for (String p : noCheckPaths) {// 判断该请求url是否需要验证
        if (path.indexOf(p) == 0) {
            isVerification = false;
            break;
        }
    }
    // &quot;/view/&quot; 路径下的js css，不校验
    if (path.indexOf(&quot;/view/&quot;) == 0
            &amp;&amp; (path.indexOf(&quot;.js&quot;) &gt; 0 || path.indexOf(&quot;.js?&quot;) &gt; 0 || path.indexOf(&quot;.css&quot;) &gt; 0)) {
        isVerification = false;
    }
    return isVerification;
}


/**
 *  服务器启动是过滤器初始化的参数  加载不需要验证的url
 */
public void init(FilterConfig config) throws ServletException {
    // 获取web.xml文件的unCheckPaths元素的内容，即配置的不需要验证的url
    String unCheckPath = config.getInitParameter(&quot;unCheckPaths&quot;);
    this.noCheckPaths = unCheckPath.split(&quot;,&quot;);
    // 获取工程名
    contextPath = config.getServletContext().getContextPath();
}
</code></pre><p>}</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/mmlswa.github.io/2020/05/19/SWITCH评测/" rel="next" title="SWITCH评测">
                <i class="fa fa-chevron-left"></i> SWITCH评测
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">

      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      
      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/mmlswa.github.io/images/head.jpg"
                alt="ZhouHua" />
            
              <p class="site-author-name" itemprop="name">ZhouHua</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/mmlswa.github.io/archives/">
              
                  <span class="site-state-item-count">13</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      
    </div>

  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ZhouHua</span>

  
</div>

        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/mmlswa.github.io/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/mmlswa.github.io/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/mmlswa.github.io/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/mmlswa.github.io/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/mmlswa.github.io/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/mmlswa.github.io/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/mmlswa.github.io/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/mmlswa.github.io/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/mmlswa.github.io/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/mmlswa.github.io/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/mmlswa.github.io/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/mmlswa.github.io/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/mmlswa.github.io/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

<script src="/mmlswa.github.io/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
